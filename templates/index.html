<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ePaper Web UI</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    canvas { border: 1px solid #aaa; display: block; margin-top: 10px; }
    .form-group { margin-bottom: 1em; }
  </style>
</head>
<body>
  <h1>ePaper Display Web UI</h1>

  <form method="POST" enctype="multipart/form-data">
    <div class="form-group">
      <label for="image">Upload Image:</label>
      <input type="file" id="image" name="image" accept="image/*">
    </div>

    <div class="form-group">
      <label>Contrast:</label>
      <input type="range" name="contrast" min="0.5" max="3.0" value="1.8" step="0.1">
      <label>Sharpness:</label>
      <input type="range" name="sharpness" min="0.5" max="3.0" value="1.0" step="0.1">
      <label>Green Bias:</label>
      <input type="range" name="green_bias" min="1.0" max="2.0" value="1.3" step="0.1">
    </div>

    <div class="form-group">
      <label>Resize Mode:</label>
      <label><input type="radio" name="resizemode" value="pad" checked> Pad</label>
      <label><input type="radio" name="resizemode" value="crop"> Crop</label>
    </div>

    <div class="form-group">
      <label><input type="checkbox" name="show_overlay" id="show_overlay"> Show Overlay Text</label><br>
      <label>Text:</label>
      <input type="text" name="overlay_text">
      <label>Position:</label>
      <select name="overlay_position">
        <option value="top-left">Top Left</option>
        <option value="top-right">Top Right</option>
        <option value="bottom-left">Bottom Left</option>
        <option value="bottom-right">Bottom Right</option>
      </select>
      <label>Font Size:</label>
      <input type="number" name="overlay_font_size" value="18">
      <label>Font Color:</label>
      <input type="color" name="overlay_font_color" value="#000000">
    </div>

    <div class="form-group">
      <button type="submit">Send to Display</button>
    </div>
  </form>

  <hr>
  <h2>Generate Image with FLUX (Hugging Face)</h2>
  <form id="generate-form">
    <label for="prompt">Enter prompt:</label>
    <input type="text" id="prompt" name="prompt" style="width: 400px;">
    <button type="submit">Generate</button>
  </form>

  <canvas id="preview" width="800" height="480"></canvas>

  <script>
    const form = document.getElementById('generate-form');
    const canvas = document.getElementById('preview');
    const ctx = canvas.getContext('2d');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const prompt = document.getElementById('prompt').value;
      const formData = new FormData();
      formData.append('prompt', prompt);

      const response = await fetch('/generate', {
        method: 'POST',
        body: formData
      });
      const data = await response.json();
      if (data.filename) {
        const img = new Image();
        img.onload = () => {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        };
        img.src = `/uploads/${data.filename}`;
      } else {
        alert('Image generation failed: ' + data.error);
      }
    });
  </script>
</body>
</html>
